import{a as w,d as f,b as E,e as de,c as M}from"./QTable-CJyFEtHV.js";import{V as re,r as p,b,G as j,o as ue,w as ce,W as h,X as i,Z as m,$ as s,_ as o,ah as C,a3 as d,a2 as V,a0 as v,a1 as R,ae as u,a6 as y,aK as me,a7 as _,Y as ve,aa as W,ab as x,H as P,aH as pe,a4 as F,ac as H,ad as J}from"./index-DSeRMBOc.js";import{Q as fe,a as G,C as L}from"./ClosePopup-W8eqLCAW.js";import{Q as K,u as be}from"./use-quasar-807Go0gv.js";import{u as ge}from"./vue-i18n-Gz_90w47.js";import{_ as ye}from"./_plugin-vue_export-helper-B6q4rR8f.js";import"./format-BvkBI9bc.js";const we={class:"column full-height customers-page-inner"},he={class:"row items-center justify-between q-mb-xs header-bar"},Ce={class:"row items-center q-gutter-x-sm q-ml-xs title-block"},Ve={class:"text-subtitle1"},_e={class:"row items-center no-wrap q-gutter-x-xs actions-block"},qe={class:"row q-col-gutter-xs q-mb-xs filters-row"},$e={class:"col-12 col-sm-6 col-md-4"},Ae={class:"table-container"},Se={key:1,class:"text-grey-5"},xe={key:1,class:"text-grey-5"},Pe={class:"row items-center no-wrap"},Le={class:"column justify-center"},Te={class:"text-weight-medium"},Ie={key:0,class:"row items-center q-gutter-xs q-mt-xs"},De={class:"row items-center no-wrap q-gutter-xs"},ke={class:"text-grey-7 q-pa-md flex flex-center column"},Oe={class:"text-h6"},Qe={class:"text-subtitle2 text-primary q-mb-sm"},Ue={class:"q-mt-sm"},Ne={class:"row q-col-gutter-sm q-mt-sm"},ze={class:"col-6"},Be={class:"col-6"},Ee={class:"text-subtitle2 text-primary q-mb-sm q-mt-md"},Me={class:"row q-col-gutter-sm"},je={class:"col-12 col-md-6"},Re={class:"col-12 col-md-6"},We={key:0,class:"row q-col-gutter-sm q-mt-sm"},Fe={class:"col-12 col-md-6"},He={class:"col-12 col-md-6"},Je={class:"text-subtitle2 text-primary q-mb-sm q-mt-md"},Ge={class:"row q-col-gutter-sm q-mt-sm"},Ke={class:"col-8"},Xe={class:"col-4"},Ye={class:"text-subtitle2 text-primary q-mb-sm q-mt-md"},Ze={class:"row q-col-gutter-sm"},et={class:"col-12 col-md-4"},tt={class:"col-12 col-md-4"},lt={class:"col-12 col-md-4"},at={class:"text-subtitle2 text-primary q-mb-sm q-mt-md"},ot={class:"text-h6"},st=re({__name:"CustomersPage",setup(it){const T=be(),{t:n}=ge(),r=p([]),I=p(""),X=b(()=>[{value:"individual",label:n("individual")},{value:"company",label:n("company")}]),Y=b(()=>[{value:"standard",label:n("standard")},{value:"preferential",label:n("preferential")},{value:"wholesale",label:n("wholesale")}]),Z=b(()=>[{name:"name",field:"name",label:n("name"),align:"left",sortable:!0},{name:"customerType",field:"customerType",label:n("customerType"),align:"left",sortable:!0,format:t=>n(t)},{name:"phone",field:"phone",label:n("phone"),align:"left",sortable:!0},{name:"email",field:"email",label:n("email"),align:"left",sortable:!0},{name:"city",field:"city",label:n("city"),align:"left",sortable:!0},{name:"priceCategory",field:"priceCategory",label:n("priceCategory"),align:"left",sortable:!0,format:t=>n(t)},{name:"creditLimit",field:"creditLimit",label:n("creditLimit"),align:"right",sortable:!0},{name:"discountPercentage",field:"discountPercentage",label:n("discount"),align:"right",sortable:!0},{name:"isActive",field:"isActive",label:n("status"),align:"center",sortable:!0,format:t=>n(t?"active":"inactive")},{name:"createdAt",field:"createdAt",label:n("date"),align:"left",sortable:!0,format:t=>new Date(t).toLocaleDateString()},{name:"actions",field:"actions",label:"",align:"right",style:"width: 100px",headerStyle:"width: 100px"}]),D=b(()=>{const t=I.value.trim().toLowerCase();return t?r.value.filter(a=>a.name.toLowerCase().includes(t)||(a.phone||"").toLowerCase().includes(t)||(a.email||"").toLowerCase().includes(t)||(a.city||"").toLowerCase().includes(t)||(a.address||"").toLowerCase().includes(t)||(a.taxId||"").toLowerCase().includes(t)||a.customerType.toLowerCase().includes(t)||a.priceCategory.toLowerCase().includes(t)):r.value}),k=p(typeof window<"u"?window.innerWidth:1200),ee=b(()=>{const t=k.value,a=Z.value;let e;const Q=["name","customerType","creditLimit","discountPercentage","actions"];return t>=1200?e=a:t>=1e3?e=a.filter(c=>!["createdAt"].includes(c.name)):t>=800?e=a.filter(c=>!["createdAt","city"].includes(c.name)):t>=650?e=a.filter(c=>!["createdAt","city","email"].includes(c.name)):t>=500?e=a.filter(c=>!["createdAt","city","email","isActive"].includes(c.name)):e=a.filter(c=>["name","customerType","phone","creditLimit","discountPercentage","actions"].includes(c.name)),Q.forEach(c=>{if(!e.some(S=>S.name===c)){const S=a.find(ne=>ne.name===c);S&&e.push(S)}}),e});function U(){k.value=window.innerWidth}j(()=>{typeof window<"u"&&window.addEventListener("resize",U,{passive:!0})}),ue(()=>{typeof window<"u"&&window.removeEventListener("resize",U)});const N={page:1,rowsPerPage:20,sortBy:"name",descending:!1},g=p(!1),q=p(!1),l=p({name:"",customerType:"individual",priceCategory:"standard",isActive:!0,creditLimit:0,discountPercentage:0}),z=b(()=>l.value.name.trim().length===0&&g.value),B=b(()=>!z.value);function te(){q.value=!1,l.value={name:"",customerType:"individual",priceCategory:"standard",isActive:!0},g.value=!0}function le(t){q.value=!0,Object.assign(l.value,{id:t.id,name:t.name,phone:t.phone||void 0,email:t.email||void 0,notes:t.notes||void 0,customerType:t.customerType,priceCategory:t.priceCategory,address:t.address||void 0,city:t.city||void 0,postalCode:t.postalCode||void 0,taxId:t.taxId||void 0,contactPerson:t.contactPerson||void 0,website:t.website||void 0,creditLimit:t.creditLimit||void 0,discountPercentage:t.discountPercentage||void 0,isActive:t.isActive??!0}),g.value=!0}function ae(){if(B.value){if(q.value&&l.value.id!=null){const t=r.value.findIndex(a=>a.id===l.value.id);t>-1&&(r.value[t]={...r.value[t],...l.value}),T.notify({type:"positive",message:n("save")})}else{const t={id:Date.now(),name:l.value.name.trim(),createdAt:new Date().toISOString(),customerType:l.value.customerType,priceCategory:l.value.priceCategory,isActive:l.value.isActive??!0,totalOrders:0,totalSpent:0,...l.value.phone?.trim()&&{phone:l.value.phone.trim()},...l.value.email?.trim()&&{email:l.value.email.trim()},...l.value.notes?.trim()&&{notes:l.value.notes.trim()},...l.value.address?.trim()&&{address:l.value.address.trim()},...l.value.city?.trim()&&{city:l.value.city.trim()},...l.value.postalCode?.trim()&&{postalCode:l.value.postalCode.trim()},...l.value.taxId?.trim()&&{taxId:l.value.taxId.trim()},...l.value.contactPerson?.trim()&&{contactPerson:l.value.contactPerson.trim()},...l.value.website?.trim()&&{website:l.value.website.trim()},...l.value.creditLimit&&l.value.creditLimit>0&&{creditLimit:l.value.creditLimit},...l.value.discountPercentage&&l.value.discountPercentage>0&&{discountPercentage:l.value.discountPercentage}};r.value.push(t),T.notify({type:"positive",message:n("save")})}O(),g.value=!1}}const $=p(!1),A=p(null);function oe(t){A.value=t,$.value=!0}function se(){A.value&&(r.value=r.value.filter(t=>t.id!==A.value.id),O(),T.notify({type:"warning",message:n("delete")})),$.value=!1}function O(){try{localStorage.setItem("customers",JSON.stringify(r.value))}catch{}}function ie(){try{const t=localStorage.getItem("customers");if(t){const a=JSON.parse(t);Array.isArray(a)&&(r.value=a.map(e=>({...e,createdAt:e.createdAt||new Date().toISOString(),customerType:e.customerType==="company"?"company":"individual",priceCategory:["standard","preferential","wholesale"].includes(e.priceCategory)?e.priceCategory:"standard"})))}}catch{}r.value.length===0&&(r.value=[{id:1,name:"Walk-in Customer",createdAt:new Date().toISOString(),customerType:"individual",priceCategory:"standard",isActive:!0,totalOrders:0,totalSpent:0},{id:2,name:"Alice Martin",phone:"0612-345-678",email:"alice@example.com",address:"123 Main Street",city:"Casablanca",postalCode:"20000",notes:"Regular customer, prefers morning visits",createdAt:new Date().toISOString(),customerType:"individual",priceCategory:"preferential",discountPercentage:5,creditLimit:1e3,isActive:!0,totalOrders:25,totalSpent:2500.5,lastOrderDate:new Date(Date.now()-10080*60*1e3).toISOString()},{id:3,name:"TechnoSoft Solutions",phone:"0522-999-888",email:"contact@technosoft.ma",contactPerson:"Mohammed Bennani",website:"www.technosoft.ma",address:"456 Business Avenue",city:"Rabat",postalCode:"10000",taxId:"IF12345678",notes:"IT company, bulk orders for office supplies",createdAt:new Date().toISOString(),customerType:"company",priceCategory:"wholesale",discountPercentage:15,creditLimit:5e3,isActive:!0,totalOrders:8,totalSpent:12400.75,lastOrderDate:new Date(Date.now()-4320*60*1e3).toISOString()},{id:4,name:"Sara El Amrani",phone:"0661-123-456",email:"sara.elamrani@gmail.com",address:"789 Student Street",city:"FÃ¨s",postalCode:"30000",notes:"Art student, frequent stationery purchases",createdAt:new Date().toISOString(),customerType:"individual",priceCategory:"standard",isActive:!0,totalOrders:15,totalSpent:850.25,lastOrderDate:new Date(Date.now()-2880*60*1e3).toISOString()}])}return j(ie),ce(r,O,{deep:!0}),(t,a)=>(m(),h(fe,{class:"q-pa-sm q-pt-xs customers-page"},{default:i(()=>[s("div",we,[s("div",he,[s("div",Ce,[s("div",Ve,d(t.$t("customers")),1),D.value.length?(m(),h(w,{key:0,color:"primary",align:"middle",class:"q-ml-md"},{default:i(()=>[V(d(D.value.length),1)]),_:1})):C("",!0)]),s("div",_e,[o(v,{dense:"",flat:"",color:"primary",icon:"person_add",label:t.$t("add"),onClick:te,class:"add-btn"},null,8,["label"])])]),s("div",qe,[s("div",$e,[o(u,{modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value=e),dense:"",outlined:"",clearable:"",debounce:"200",placeholder:t.$t("search")},{prepend:i(()=>[o(R,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),a[19]||(a[19]=s("div",{class:"col-12 col-sm-6 col-md-8 flex items-center justify-end gap-xs meta-slot"},null,-1))]),s("div",Ae,[o(de,{class:"customers-table",flat:"",rows:D.value,columns:ee.value,"row-key":"id",pagination:N,"onUpdate:pagination":a[1]||(a[1]=e=>Object.assign(N,e)),"rows-per-page-options":[10,20,50]},{"body-cell-customerType":i(e=>[o(f,{props:e},{default:i(()=>[o(G,{color:e.value==="individual"?"blue-grey-4":"indigo-5","text-color":(e.value==="individual","white"),icon:e.value==="individual"?"person":"business",dense:"",size:"sm"},{default:i(()=>[V(d(y(n)(e.value)),1)]),_:2},1032,["color","text-color","icon"])]),_:2},1032,["props"])]),"body-cell-priceCategory":i(e=>[o(f,{props:e},{default:i(()=>[o(w,{color:e.value==="wholesale"?"purple":e.value==="preferential"?"orange":"grey-6",label:y(n)(e.value),align:"middle"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-isActive":i(e=>[o(f,{props:e},{default:i(()=>[o(G,{color:e.value?"positive":"grey-5","text-color":(e.value,"white"),icon:e.value?"check_circle":"cancel",dense:"",size:"sm"},{default:i(()=>[V(d(e.value?y(n)("active"):y(n)("inactive")),1)]),_:2},1032,["color","text-color","icon"])]),_:2},1032,["props"])]),"body-cell-creditLimit":i(e=>[o(f,{props:e},{default:i(()=>[e.value!=null&&Number(e.value)>0?(m(),_("span",{key:0,class:ve(["text-weight-medium",Number(e.value)>=5e3?"text-green-7":Number(e.value)>=1e3?"text-orange-7":"text-blue-7"])},d(Number(e.value).toFixed(2))+" MAD ",3)):(m(),_("span",Se,"-"))]),_:2},1032,["props"])]),"body-cell-discountPercentage":i(e=>[o(f,{props:e},{default:i(()=>[e.value!=null&&Number(e.value)>0?(m(),h(w,{key:0,color:Number(e.value)>=15?"red-5":Number(e.value)>=10?"orange-5":"blue-5",label:`${Number(e.value)}%`,align:"middle"},null,8,["color","label"])):(m(),_("span",xe,"-"))]),_:2},1032,["props"])]),"body-cell-name":i(e=>[o(f,{props:e,class:"name-cell"},{default:i(()=>[s("div",Pe,[o(me,{size:"28px",color:e.row.customerType==="company"?"indigo-5":"blue-grey-4","text-color":"white",icon:e.row.customerType==="company"?"business":"person",class:"q-mr-sm avatar-centered"},null,8,["color","icon"]),s("div",Le,[s("span",Te,d(e.value),1),k.value<500?(m(),_("div",Ie,[e.row.creditLimit&&e.row.creditLimit>0?(m(),h(w,{key:0,color:e.row.creditLimit>=5e3?"green-5":e.row.creditLimit>=1e3?"orange-5":"blue-5",label:`${e.row.creditLimit} MAD`,size:"xs"},null,8,["color","label"])):C("",!0),e.row.discountPercentage&&e.row.discountPercentage>0?(m(),h(w,{key:1,color:e.row.discountPercentage>=15?"red-5":e.row.discountPercentage>=10?"orange-5":"blue-5",label:`${e.row.discountPercentage}%`,size:"xs"},null,8,["color","label"])):C("",!0)])):C("",!0)])])]),_:2},1032,["props"])]),"body-cell-actions":i(e=>[o(f,{props:e,class:"actions-cell"},{default:i(()=>[s("div",De,[o(v,{dense:"",round:"",flat:"",size:"sm",icon:"edit",color:"primary",onClick:Q=>le(e.row),class:"hover-btn action-btn"},{default:i(()=>[o(E,null,{default:i(()=>[V(d(y(n)("edit")),1)]),_:1})]),_:2},1032,["onClick"]),o(v,{dense:"",round:"",flat:"",size:"sm",icon:"delete",color:"negative",onClick:Q=>oe(e.row),class:"hover-btn action-btn"},{default:i(()=>[o(E,null,{default:i(()=>[V(d(y(n)("delete")),1)]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":i(()=>[s("div",ke,[o(R,{name:"groups",size:"42px",class:"q-mb-sm"}),s("div",null,d(t.$t("noResults")),1)])]),_:1},8,["rows","columns"])])]),o(J,{modelValue:g.value,"onUpdate:modelValue":a[17]||(a[17]=e=>g.value=e)},{default:i(()=>[o(W,{style:{width:"620px","max-width":"95vw"},class:"q-pa-sm"},{default:i(()=>[o(x,{class:"row items-center q-pb-none"},{default:i(()=>[s("div",Oe,d(q.value?t.$t("edit"):t.$t("add"))+" "+d(t.$t("customers")),1),o(K),P(o(v,{icon:"close",flat:"",round:"",dense:""},null,512),[[L]])]),_:1}),o(x,{class:"q-pt-sm"},{default:i(()=>[s("div",Qe,d(t.$t("basicInformation")),1),o(u,{modelValue:l.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.name=e),label:t.$t("name"),dense:"",outlined:"",autofocus:"",error:z.value,"error-message":t.$t("required")},null,8,["modelValue","label","error","error-message"]),s("div",Ue,[o(pe,{modelValue:l.value.isActive,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.isActive=e),label:t.$t("active"),dense:""},null,8,["modelValue","label"])]),s("div",Ne,[s("div",ze,[o(M,{modelValue:l.value.customerType,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.customerType=e),options:X.value,"option-value":"value","option-label":"label",dense:"",outlined:"","emit-value":"","map-options":"",label:t.$t("customerType")},null,8,["modelValue","options","label"])]),s("div",Be,[o(M,{modelValue:l.value.priceCategory,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value.priceCategory=e),options:Y.value,"option-value":"value","option-label":"label",dense:"",outlined:"","emit-value":"","map-options":"",label:t.$t("priceCategory")},null,8,["modelValue","options","label"])])]),s("div",Ee,d(t.$t("contactInformation")),1),s("div",Me,[s("div",je,[o(u,{modelValue:l.value.phone,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.phone=e),label:t.$t("phone"),dense:"",outlined:""},null,8,["modelValue","label"])]),s("div",Re,[o(u,{modelValue:l.value.email,"onUpdate:modelValue":a[7]||(a[7]=e=>l.value.email=e),label:t.$t("email"),type:"email",dense:"",outlined:""},null,8,["modelValue","label"])])]),l.value.customerType==="company"?(m(),_("div",We,[s("div",Fe,[o(u,{modelValue:l.value.contactPerson,"onUpdate:modelValue":a[8]||(a[8]=e=>l.value.contactPerson=e),label:t.$t("contactPerson"),dense:"",outlined:""},null,8,["modelValue","label"])]),s("div",He,[o(u,{modelValue:l.value.website,"onUpdate:modelValue":a[9]||(a[9]=e=>l.value.website=e),label:t.$t("website"),dense:"",outlined:""},null,8,["modelValue","label"])])])):C("",!0),s("div",Je,d(t.$t("addressInformation")),1),o(u,{modelValue:l.value.address,"onUpdate:modelValue":a[10]||(a[10]=e=>l.value.address=e),label:t.$t("address"),dense:"",outlined:""},null,8,["modelValue","label"]),s("div",Ge,[s("div",Ke,[o(u,{modelValue:l.value.city,"onUpdate:modelValue":a[11]||(a[11]=e=>l.value.city=e),label:t.$t("city"),dense:"",outlined:""},null,8,["modelValue","label"])]),s("div",Xe,[o(u,{modelValue:l.value.postalCode,"onUpdate:modelValue":a[12]||(a[12]=e=>l.value.postalCode=e),label:t.$t("postalCode"),dense:"",outlined:""},null,8,["modelValue","label"])])]),s("div",Ye,d(t.$t("financialInformation")),1),s("div",Ze,[s("div",et,[o(u,{modelValue:l.value.taxId,"onUpdate:modelValue":a[13]||(a[13]=e=>l.value.taxId=e),label:t.$t("taxId"),dense:"",outlined:""},null,8,["modelValue","label"])]),s("div",tt,[o(u,{modelValue:l.value.creditLimit,"onUpdate:modelValue":a[14]||(a[14]=e=>l.value.creditLimit=e),label:t.$t("creditLimit"),type:"number",suffix:"MAD",dense:"",outlined:""},null,8,["modelValue","label"])]),s("div",lt,[o(u,{modelValue:l.value.discountPercentage,"onUpdate:modelValue":a[15]||(a[15]=e=>l.value.discountPercentage=e),label:t.$t("discountPercentage"),type:"number",suffix:"%",min:"0",max:"100",dense:"",outlined:""},null,8,["modelValue","label"])])]),s("div",at,d(t.$t("additionalNotes")),1),o(u,{modelValue:l.value.notes,"onUpdate:modelValue":a[16]||(a[16]=e=>l.value.notes=e),label:t.$t("notes"),type:"textarea",autogrow:"",rows:"2",dense:"",outlined:""},null,8,["modelValue","label"])]),_:1}),o(F,{inset:""}),o(H,{align:"right"},{default:i(()=>[P(o(v,{flat:"",label:t.$t("cancel")},null,8,["label"]),[[L]]),o(v,{color:"primary",disable:!B.value,label:t.$t("save"),onClick:ae},null,8,["disable","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(J,{modelValue:$.value,"onUpdate:modelValue":a[18]||(a[18]=e=>$.value=e)},{default:i(()=>[o(W,{style:{width:"400px","max-width":"90vw"},class:"q-pa-sm"},{default:i(()=>[o(x,{class:"row items-center q-pb-none"},{default:i(()=>[s("div",ot,d(t.$t("delete"))+" "+d(t.$t("customers")),1),o(K),P(o(v,{icon:"close",flat:"",round:"",dense:""},null,512),[[L]])]),_:1}),o(x,{class:"q-pt-sm"},{default:i(()=>[s("div",null,d(t.$t("confirmDeleteCustomer",{name:A.value?.name||""})),1)]),_:1}),o(F),o(H,{align:"right"},{default:i(()=>[P(o(v,{flat:"",label:t.$t("cancel")},null,8,["label"]),[[L]]),o(v,{color:"negative",label:t.$t("delete"),onClick:se},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ft=ye(st,[["__scopeId","data-v-a9b9fb90"]]);export{ft as default};
